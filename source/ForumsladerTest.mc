import Toybox.Lang;
import Toybox.Test;
import Toybox.Activity;

//! Unit test function challenging the parser with valid and invalid payloads
(:test)  public function parserTest(logger as Logger) as Boolean {    

        var _testDataSet = [
        "$FLB,240,102269,737,0*73",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,226,1217,3282,8873*5D",
        "$FLC,4,0,200,0,16,0*78",
        "$FLZ,4,0,200,0,16,0*61",
        "$FL5,00C000,0,0,3789,3788,3688,-7,0,296,1,225,1217,3282,8873*51",
        "$FLB,240,102280,728,0*7A",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,224,1217,3282,8873*5F",
        "$FLC,5,826,55,1386,31,33156710*4A",
        "$FL5,00C000,0,0,3789,3788,3688,-11,0,296,1,231,1217,3282,8873*63",
        "$FLB,240,102272,735,0*7B",
        "AT+SLEEP",
        "$FL5,00C000,0,0,3789,3789,3688,-12,0,296,1,230,1217,3282,8873*60",
        "$FLV,2003.500221217,5.51*5C",
        "$FLC,2,176240,-207,0,0,210*56",
        "$FL5,00C000,0,0,3788,3789,3689,-12,0,296,1,229,1217,3282,8873*68",
        "$FL5,00C000,0,0,3789,3788,3688,-11,0,296,1,231,1217,3282,8873*63",
        "AT+SLEEP",
        "$FLB,240,102272,735,0*7B",
        "$FL5,00C000,0,0,3789,3789,3688,-12,0,296,1,230,1217,3282,8873*60",
        "$FLV,2003.500221217,5.51*5C",
        "hdkshdadk√∂lsfd",
        "$FLC,2,176240,-207,0,0,210*56",
        "$FL5,00C000,0,0,3788,3789,3689,-12,0,296,1,229,1217,3282,8873*68",
        "$FLB,240,102275,733,0*7A",
        "$FLP,2133,13,-800,13553,21749,13111,21063,407,60,0,104*5F",
        "$FL5,00C000,0,0,3788sdfdsgdgsfg,3789,3688,-8,0,296,1,228,1217,3282,8873*53",
        "$FLC,3,3545,3545,0,484,0*42",
        "$FL5,00C000,0,0,3789,3789,3688,-9,0,296,1,227,1217,3282,8873*5C",
        "$FLB,240,102269,737,0*73",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,226,1217,3282,8873*5D",
        "$FLC,4,0,200,0,16,0*78",
        "$FL5,00C000,0,0,3789,3788,3688,-7,0,296,1,225,1217,3282,8873*51",
        "$FLB,240,102280,728,0*7A",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,224,1217,3282,8873*5F",
        "$FLC,5,826,55,1386,31,33156710*4A",
        "$FL5,00C000,0,0,3789,3788,3688,-11,0,296,1,231,1217,3282,8873*63",
        "$FLB,240,102272,735,0*7B",
        "$FL5,00C000,0,0,3789,3789,3688,-12,0,296,1,230,1217,3282,8873*60",
        "$FL5,00C000,0,0,3789,3788,3688,-11,0,296,1,231,1217,3282,8873*63",
        "$FLB,240,102272,735,0*7B",
        "$FL5,00C000,0,0,3789,3789,3688,-12,0,296,1,230,1217,3282,8873*60",
        "$FLV,2003.500221217,5.51*5C",
        "$FLC,2,176240,-207,0,0,210*56",
        "$FL5,00C000,0,0,3788,3789,3689,-12,0,296,1,229,1217,3282,8873*68",
        "$FLB,240,102275,733,0*7A",
        "$FLP,2133,13,-800,13553,21749,13111,21063,407,60,0,104*5F",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,228,1217,3282,8873*53",
        "$FLC,3,3545,3545,0,484,0*42",
        "$FL5,00C000,0,0,3789,3789,3688,-9,0,296,1,227,1217,3282,8873*5C",
        "$FLB,240,102269,737,0*73",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,226,1217,3282,8873*5D",
        "$FLC,4,0,200,0,16,0*78",
        "$FL5,00C000,0,0,3789,3788,3688,-7,0,296,1,225,1217,3282,8873*51",
        "$FLB,240,102280,728,0*7A",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,224,1217,3282,8873*5F",
        "$FLC,5,826,55,1386,31,33156710*4A",
        "$FL5,00C000,0,0,3789,3788,3688,-11,0,296,1,231,1217,3282,8873*63",
        "$FLB,240,102272,735,0*7B",
        "$FL5,00C000,0,0,3789,3789,3688,-12,0,296,1,230,1217,3282,8873*60",
        "$FLC,2,176240,-207,0,0,210*56",
        "$FL5,00C000,0,0,3788,3789,3689,-12,0,296,1,229,1217,3282,8873*68",
        "$FLB,240,102275,733,0*7A",
        "$FLP,2133,13,-800,13553,21749,13111,21063,407,60,0,104*5F",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,228,1217,3282,8873*53",
        "$FLC,3,3545,3545,0,484,0*42",
        "$FL5,00C000,0,0,3789,3789,3688,-9,0,296,1,227,1217,3282,8873*5C",
        "$FL5,00C000,0,0,3789,3788,3688,-11,0,296,1,231,1217,3282,8873*63",
        "$FLB,240,102272,735,0*7B",
        "$FL5,00C000,0,0,3789,3789,3688,-12,0,296,1,230,1217,3282,8873*60",
        "$FLV,2003.500221217,5.51*5C",
        "$FLC,2,176240,-207,0,0,210*56",
        "$FL5,00C000,0,0,3788,3789,3689,-12,0,296,1,229,1217,3282,8873*68",
        "$FLB,240,102275,733,0*7A",
        "$FLP,2133,13,-800,13553,21749,13111,21063,407,60,0,104*5F",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,228,1217,3282,8873*53",
        "$FLC,3,3545,3545,0,484,0*42",
        "$FL5,00C000,0,0,3789,3789,3688,-9,0,296,1,227,1217,3282,8873*5C",
        "$FLB,240,102269,737,0*73",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,226,1217,3282,8873*5D",
        "$FLC,4,0,200,0,16,0*78",
        "$FL5,00C000,0,0,3789,3788,3688,-7,0,296,1,225,1217,3282,8873*51",
        "$FLB,240,102280,728,0*7A",
        "$FL5,00C000,0,0,3788,3789,3688,-8,0,296,1,224,1217,3282,8873*5F",
        "$FLC,5,826,55,1386,31,33156710*4A"] as Array<String>;

        $.FLstate = FL_READY;

        var _data = new $.DataManager();
        var _view = new $.ForumsladerView(_data as DataManager);

        for (var i = 0; i < _testDataSet.size(); i++) {
            debug(_testDataSet[i]);
            try {
        	    _data.encode((_testDataSet[i] + "\r\n").toUtf8Array() as ByteArray);
                _view.compute(Activity.Info as Info);
                debug(_view._displayString);
            }
            catch (exception) {
                return false;
            }
    	}
        return true;
    }